<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ZPRINT v2.7 – Work Order</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { font-family: Arial, sans-serif; padding: 20px; max-width: 560px; }
label { display: block; margin-top: 14px; font-weight: bold; }
select, input, button {
  width: 100%;
  padding: 8px;
  margin-top: 4px;
  box-sizing: border-box;
}
button { margin-top: 18px; }
#result { margin-top: 20px; }
#status { color: green; font-weight: bold; margin-bottom: 10px; }
</style>
</head>

<body>

<h2>ZPRINT v2.7 – Work Order</h2>
<div id="status">JS RUNNING ✔</div>

<!-- =========================
     DROPDOWNS (DO NOT TOUCH)
========================= -->

<label>Category</label>
<select id="category"></select>

<label>Subcategory</label>
<select id="subcategory"></select>

<!-- =========================
     ADDITIONAL FIELDS
========================= -->

<label>Client Name</label>
<input id="client">

<label>Client Phone</label>
<input id="phone">

<label>Description</label>
<input id="description">

<label>Version</label>
<input id="version" value="v0">

<button id="generateBtn" type="button">Generate</button>

<div id="result" style="display:none">
  <p><strong>Generated Filename</strong></p>
  <input id="filename" readonly>
  <button type="button" onclick="copyFilename()">COPY</button>
</div>

<script>
/* ===============================
   CONFIG
================================ */
const SCRIPT_URL = "PASTE_V2_7_EXEC_URL_HERE";

/* ===============================
   CATEGORY MASTER (v2.6 FINAL)
================================ */
const CATEGORIES = {
  PVC:{subs:{CLEAR:"Clear",PRC:"Print & Cut",UV:"UV",UVPC:"UV Print & Cut",CUT:"Cutting",PLN:"Plain",GLDC:"Gold Cutting",GLDP:"Gold Plain",ECO:"Eco",CLRPRC:"Clear Print & Cut",FRPL:"Frost Plain",FRCUT:"Frost Cut",FRPRC:"Frost Print & Cut",MAG:"Magnet"}},
  EMB:{subs:{STD:"Standard",PRM:"Premium"}},
  CAN:{subs:{COT:"Cotton",UV:"UV",ECO:"Eco",OTH:"Other"}},
  BAN:{subs:{UV:"UV",ECO:"Eco",TD:"Tear Drop",FECO:"Flag Eco",FUV:"Flag UV",POP:"POP",STD:"Standard",PRM:"Premium"}},
  MAP:{subs:{NRM:"Normal",PP:"PP",POP:"POP"}},
  SUB:{subs:{SUB:"Sublimation"}},
  DTF:{subs:{DTF:"DTF"}},
  CON:{subs:{UV:"UV",ECO:"Eco",PLN:"Plain"}},
  FLT:{subs:{UVD:"UV_DTF",PEN:"Pen",NOTE:"Notebook",ACR:"Acrylic"}},
  PUB:{subs:{FLY:"Flyer",BR:"Brochure",BC:"Business Card",OTH:"Other"}},
  CUS:{subs:{CUS:"Custom Input"}}
};

/* ===============================
   DROPDOWN LOGIC (VERBATIM)
   DO NOT MODIFY
================================ */
const cat = document.getElementById("category");
const sub = document.getElementById("subcategory");

cat.innerHTML = "<option value=''>Select Category</option>";
sub.innerHTML = "<option value=''>Select Subcategory</option>";

Object.keys(CATEGORIES).forEach(c=>{
  const o=document.createElement("option");
  o.value=c;
  o.textContent=c;
  cat.appendChild(o);
});

cat.onchange = ()=>{
  sub.innerHTML = "<option value=''>Select Subcategory</option>";
  Object.keys(CATEGORIES[cat.value]?.subs || {}).forEach(s=>{
    const o=document.createElement("option");
    o.value=s;
    o.textContent=s;
    sub.appendChild(o);
  });
};

/* ===============================
   GENERATE WO
================================ */
document.getElementById("generateBtn").onclick = async () => {
  const params = new URLSearchParams({
    action: "createWO",
    category: cat.value,
    subcategory: sub.value,
    client: client.value,
    phone: phone.value,
    description: description.value,
    version: version.value || "v0"
  });

  const res = await fetch(`${SCRIPT_URL}?${params}`);
  const data = await res.json();

  if (!data.filename) {
    alert("Failed to generate filename");
    return;
  }

  filename.value = data.filename;
  document.getElementById("result").style.display = "block";
};

/* ===============================
   COPY
================================ */
function copyFilename(){
  filename.select();
  document.execCommand("copy");
}
</script>

</body>
</html>
